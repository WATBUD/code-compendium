# React 列表渲染中的 `key` 屬性

在 React 中，`key` 是一個特殊屬性，用於幫助框架高效地更新和渲染列表。以下是關於 `key` 的重要概念與差異說明。

---

## 為什麼需要 `key`

React 使用 Virtual DOM 技術比較新舊 DOM 結構，然後只更新需要變更的部分。`key` 是 React 的提示，用來識別每個列表項的唯一性。

### 有 `key` 的情況

- React 可以準確識別每個列表項，當列表內容發生變化（例如新增或刪除項目）時，只更新受影響的 DOM 節點。
- 提高性能，避免不必要的重渲染。

### 沒有 `key` 的情況

- React 會使用默認索引作為 `key`，這可能導致：
  - **性能下降**：React 可能會重新渲染整個列表。
  - **UI 異常**：例如輸入框內容丟失、動畫中斷等。

---

## 代碼範例

### 有 `key`

```jsx
{data.map((item) => (
  <li key={item.id}>{item.text}</li>
))}
```

- React 使用 `item.id` 作為唯一標識。
- 當列表發生變化時，React 只更新受影響的項目。

### 沒有 `key`

```jsx
{data.map((item) => (
  <li>{item.text}</li>
))}
```

- React 使用默認索引作為 `key`。
- 如果列表項目重新排序或插入新項目，可能導致以下問題：
  - **性能問題**：整個列表被重新渲染。
  - **UI 異常**：React 可能誤認為某些項目是新的，導致狀態丟失。

---

## 使用 `key` 的實際影響

假設初始數據如下：

```jsx
const data = [
  { id: 1, text: "A" },
  { id: 2, text: "B" },
  { id: 3, text: "C" },
];
```

**第一次渲染結果：**

```html
<li>A</li>
<li>B</li>
<li>C</li>
```

如果插入新項目：

```jsx
const data = [
  { id: 4, text: "D" },
  { id: 1, text: "A" },
  { id: 2, text: "B" },
  { id: 3, text: "C" },
];
```

### **有 `key` 時**

React 能夠準確識別每個項目，並僅插入新的 `<li>D</li>`，其他項目保持不變。

### **無 `key` 時**

React 使用索引比較項目，可能導致：
- 重複渲染整個列表。
- 原本顯示 "A" 的 `<li>` 被重新渲染為 "D"，導致 UI 異常。

---

## 如何選擇 `key`

- **首選唯一標識符**：如 `id` 或數據庫中的主鍵。
- **避免使用索引作為 `key`**：
  - 如果數據是靜態的且不會變動，可以使用索引。
  - 當列表需要頻繁插入、刪除或重新排序時，索引作為 `key` 會導致問題。

---

## 結論

- 使用正確的 `key` 能提高 React 列表渲染的性能，並避免 UI 問題。
- 將 `key` 設為唯一標識符（如 `id`）是 React 開發中的最佳實踐。
