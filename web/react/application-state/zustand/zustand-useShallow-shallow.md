
### âœ… ä½¿ç”¨ Zustand æ’ˆå–å¤šå€‹ state å±¬æ€§æ™‚å·®ç•°ï¼š

```ts
const { a, b } = useStore((state) => ({ a: state.a, b: state.b }));
```

é€™æ®µç¨‹å¼ç¢¼æ˜¯ï¼šå¾ž store è£¡æ’ˆå‡º `a` å’Œ `b`ï¼Œä¸¦çµ„æˆä¸€å€‹æ–°ç‰©ä»¶ `{ a, b }`ã€‚ä½† **æ¯æ¬¡é€™å€‹ selector function è¢«å‘¼å«æ™‚ï¼Œé€™å€‹æ–°ç‰©ä»¶çš„è¨˜æ†¶é«”ä½å€éƒ½æœƒä¸åŒ**ï¼Œå³ä½¿ `a` å’Œ `b` æ²’è®Šã€‚

---

### âœ… å›žç­”ä½ çš„å•é¡Œï¼šã€ŒA æ”¹æˆ 7ï¼ŒB æ”¹æˆ 8ï¼Œä¹Ÿæœƒ re-render å—Žï¼Ÿã€

æœƒçš„ã€‚é€™ç¨®æƒ…æ³å…¶å¯¦æ˜¯åˆç†çš„ã€Œéœ€è¦ re-renderã€ï¼Œå› ç‚ºä½ æœ‰æ›´æ–° `a` å’Œ `b` çš„å€¼ã€‚å³ä½¿æ˜¯é€™ç¨® selectorï¼š

```ts
const { a, b } = useStore((state) => ({ a: state.a, b: state.b }));
```

Zustand åœ¨æ¯”è¼ƒå‰å¾Œ selector å›žå‚³çš„ç‰©ä»¶æ™‚ï¼Œ**æœƒç™¼ç¾ reference æ”¹è®Šäº†**ï¼ˆå³ä¾¿å€¼ä¸€æ¨£ä¹Ÿæœƒ re-renderï¼‰ï¼Œä½†åœ¨ä½ å¯¦éš›æ”¹äº† `a` å’Œ `b` çš„å€¼çš„æƒ…æ³ä¸‹ï¼Œre-render æ˜¯åˆç†çš„ã€‚

---

### âŒ å•é¡Œæ˜¯åœ¨ï¼šã€Œa å’Œ b æ²’è®Šï¼Œä½†ä»ç„¶ re-renderã€

é€™æ™‚æ‰æ˜¯ä½ è¦æ“”å¿ƒçš„æ•ˆèƒ½å•é¡Œï¼Œå› ç‚ºç‰©ä»¶ reference æ”¹è®Šäº†ï¼Œä½†å…§å®¹æ²’è®Š â†’ é€ æˆ **ä¸å¿…è¦çš„ re-render**ã€‚

---

### âœ… è§£æ³•ï¼ˆé¿å…ä¸å¿…è¦çš„ re-renderï¼‰ï¼šZustand æœƒ [shallow comparison] `a` å’Œ `b` çš„å€¼ï¼Œåªæœ‰ç•¶å®ƒå€‘å¯¦éš›è®Šå‹•æ™‚æ‰æœƒ re-renderã€‚
Zustand æœƒå°æ¯” `a` å’Œ `b` çš„å¯¦éš›å€¼è®ŠåŒ–ï¼Œè€Œéžæ•´å€‹ `{ a, b }` ç‰©ä»¶çš„è¨˜æ†¶é«”ä½ç½®ã€‚åªæœ‰ç•¶ `a` æˆ– `b` çš„å€¼**çœŸçš„æ”¹è®Š**æ™‚ï¼Œæ‰æœƒè§¸ç™¼ re-renderã€‚

`useShallow` å’Œ `shallow` åœ¨ Zustand æ˜¯ **å…©å€‹ä¸åŒçš„ç”¨é€”**ï¼Œä½†éƒ½æ˜¯ç‚ºäº†æ¸›å°‘ä¸å¿…è¦çš„ re-renderã€‚ä»¥ä¸‹å¹«ä½ æ¸…æ¥šå€åˆ†ï¼š

---

## âœ… 1. `shallow`ï¼ˆæ¯”è¼ƒ functionï¼‰

```ts
import { shallow } from 'zustand/shallow';

const { a, b } = useStore(
  (state) => ({ a: state.a, b: state.b }),
  shallow
);
```

### ç”¨é€”ï¼š

é€™æ˜¯ **ç”¨ä¾†ç•¶ä½œç¬¬äºŒåƒæ•¸** å‚³çµ¦ `useStore` çš„ **æ¯”è¼ƒ function**ï¼ŒZustand æœƒæ‹¿å®ƒä¾†æ¯”è¼ƒ selector å›žå‚³çš„ç‰©ä»¶ **æ˜¯ä¸æ˜¯ç­‰åƒ¹çš„**ã€‚

### åŠŸèƒ½ï¼š

* å¹«ä½ æ·ºæ¯”è¼ƒ object çš„æ¯å€‹ key-value å€¼ï¼ˆä¸æ˜¯ reference æ¯”è¼ƒï¼‰ã€‚
* å¦‚æžœ `a` å’Œ `b` éƒ½æ²’è®Šï¼Œå°±ä¸ re-renderï¼

---

## âœ… 2. `useShallow`ï¼ˆä¸€å€‹ helper hookï¼‰

```ts
import { useShallow } from 'zustand/react/shallow';

const state = useStore(useShallow((state) => ({ a: state.a, b: state.b })));
```

### ç”¨é€”ï¼š

* æ˜¯ä¸€å€‹**åŒ…è£éŽ selector çš„ helper hook**ï¼Œä½œç”¨åŒæ¨£æ˜¯ç”¨ `shallow` åšæ¯”è¼ƒã€‚
* çµ¦ä½ æ›´ç°¡æ½”çš„èªžæ³•ï¼ˆå…æ‰‹å‹•åŠ  `shallow` ç•¶ç¬¬äºŒåƒæ•¸ï¼‰ã€‚

### ä½†æ³¨æ„ï¼š

* å®ƒåªèƒ½ç”¨åœ¨ Zustand v4.3+ã€‚
* èªžæ„ç¨å¾®ä¸ä¸€æ¨£ï¼šä½ å‚³é€²åŽ»çš„ function æ˜¯ç¶“éŽåŒ…è£çš„ selectorã€‚

---

## ðŸ†š å·®ç•°æ¯”è¼ƒ

| æ¯”è¼ƒé …ç›®           | `shallow`                | `useShallow`                |
| -------------- | ------------------------ | --------------------------- |
| æ˜¯ä»€éº¼ï¼Ÿ           | æ¯”è¼ƒ function              | Selector åŒ…è£ helper          |
| å‚³çµ¦å“ªè£¡ï¼Ÿ          | `useStore(..., shallow)` | `useStore(useShallow(...))` |
| éœ€è¦ Zustand å¹¾ç‰ˆï¼Ÿ | v3 ä»¥ä¸Šå¯ç”¨                  | v4.3+ æ‰æœ‰                    |
| æŽ¨è–¦å“ªå€‹ï¼Ÿ          | é€šç”¨æ€§é«˜                     | ç°¡æ½”ä½†éœ€æ–°ç‰ˆ                      |

---

### âœ… å»ºè­°ç”¨æ³•ï¼ˆé€šç”¨ï¼‰ï¼š

```ts
const { a, b } = useStore((state) => ({ a: state.a, b: state.b }), shallow);
```

é€™æ¨£å¯«æœ€ç©©å®šä¹Ÿæœ€æ¸…æ¥šã€‚

---