
---

## 🧠 Redis 的 AOF 和 RDB 是什麼？

Redis 是記憶體型（in-memory）的資料庫，**資料存在記憶體中，速度很快**。
但如果伺服器突然當機，記憶體的資料就會消失。
為了**讓資料可以儲存在磁碟上（持久化）**，Redis 提供了兩種方法：

---

### 📝 AOF（Append Only File）

**記錄你對 Redis 做的每一個寫入指令（如 SET、DEL）**，並寫入到檔案中，類似日誌。

#### ✅ 優點：

* 資料恢復更完整（幾乎不會遺失）
* 每次寫入都會記錄下來，重啟時可重放指令

#### ⚠️ 缺點：

* 檔案可能越來越大（需要定期壓縮）
* 速度比 RDB 慢一點（但可接受）

#### 🔧 常用設定：

```ini
appendonly yes
appendfsync everysec  # 每秒寫一次磁碟，性能與資料安全折衷
```

---

### 📸 RDB（Redis Database Snapshot）

**定時把整個 Redis 資料快照（snapshot）儲存成一個 `.rdb` 檔案**。

#### ✅ 優點：

* 整體效能高（背景儲存，不影響主線程）
* 啟動 Redis 時速度快（讀一個二進位快照）

#### ⚠️ 缺點：

* 有可能遺失快照之後的資料（例如你 10 分鐘前備份，當機就會遺失這 10 分鐘的資料）
* 沒有記錄逐筆操作，恢復不如 AOF 精確

#### 🔧 常用設定：

```ini
save 900 1     # 900秒內有1次寫入，就存快照（15分鐘）
save 300 10    # 300秒內有10次寫入，就存快照（5分鐘）
save 60 10000  # 60秒內有10000次寫入，就存快照（1分鐘）
```

---

## 🚀 實務上該用哪個？

| 模式            | 建議使用場景           |
| ------------- | ---------------- |
| **RDB**       | 效能優先、資料變動不大      |
| **AOF**       | 資料安全優先、重啟要完整資料   |
| **AOF + RDB** | 建議使用！雙保險，兼顧效能與安全 |

Redis 預設只開啟 RDB，但生產環境通常會 **同時開啟 AOF 與 RDB**。

---

## 🔄 Redis 啟動時會怎麼選？

1. 如果有 AOF，就用 AOF 恢復（因為它比較新）
2. 沒有 AOF 才會用 RDB 快照

---

## 🧪 補充：怎麼看你用的是哪個？

你可以執行這個指令查看：

```bash
redis-cli INFO persistence
```

會看到像這樣：

```bash
rdb_bgsave_in_progress:0
aof_enabled:1
aof_last_write_status:ok
```

---
